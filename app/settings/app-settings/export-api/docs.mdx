import { DocLayout } from '../../../../components';

# Export API

The Export API allows you to programmatically retrieve events from your applications for external analysis, data warehousing, or custom reporting.

## Authentication

Before accessing the Export API, you need to obtain an authentication token by logging in.

### Login Endpoint

```bash
curl --location --request POST 'https://api.vexo.co/users/implicit/login' \
--header 'Content-Type: application/json' \
--data-raw '{
    "email": "your-email@example.com",
    "password": "your-password"
}'
```

**Response:**
```json
{
    "success": true,
    "code": 200,
    "message": null,
    "data": {
        "id": "5d10a838-1678-4110-a402-6eb0af88e41d",
        "name": "Your Name",
        "email": "your-email@example.com",
        "token": "{AUTH_TOKEN}"
    }
}
```

Use the `token` from the response in the `Authorization` header for all API requests.

## Export Events

### Get Events

Retrieve events for a specific application with optional filtering by date range and pagination.

**Endpoint:** `GET /external/apps/{appId}/events`

**Headers:**
- `Authorization: {token}` - Required authentication token from login

**Parameters:**
- `appId` (path, required) - UUID of the application
- `from` (query, optional) - Start timestamp (Unix timestamp in milliseconds)
- `to` (query, optional) - End timestamp (Unix timestamp in milliseconds)
- `itemsPerPage` (query, optional) - Number of items per page (default: 10000, max: 10000)
- `page` (query, optional) - Page number (default: 1)

**Example Request:**
```bash
curl --location --request GET 'https://api.vexo.co/external/apps/:appId/events?from=1640995200000&to=1641081600000&itemsPerPage=100&page=1' \
--header 'Authorization: {AUTH_TOKEN}'
```

**Response Structure:**
```json
{
    "success": true,
    "code": 200,
    "message": null,
    "data": {
        "totalItems": 1,
        "page": 1,
        "itemsPerPage": 10000,
        "items": [
            {
                "id": "event-id",
                "name": "screen_view",
                "route": "/home",
                "sessionId": "session-id",
                "deviceId": "device-id",
                "type": "screen",
                "appVersion": "1.0.0",
                "clientCreationDate": 1640995200000,
                "serverReceivedDate": 1640995201000,
                "clientCreationHumanReadableDate": "2021-12-31 12:00:00",
                "serverReceivedHumanReadableDate": "2021-12-31 12:00:01",
                "country": "US",
                "city": "New York",
                "deviceSystemName": "iOS",
                "deviceSystemVersion": "15.0",
                "deviceModel": "iPhone13,2",
                "metadata": {
                    "custom_property": "value",
                    "user_id": "123",
                    "additional_data": "example"
                }
            }
        ]
    }
}
```

## Event Object Structure

Each event object contains the following fields:

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Type</th>
      <th>Description</th>
      <th>Required</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>id</code></td>
      <td><code>string</code></td>
      <td>Unique event identifier</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td><code>name</code></td>
      <td><code>string</code></td>
      <td>Event name (e.g., "screen_view", "button_click")</td>
      <td>No</td>
    </tr>
    <tr>
      <td><code>route</code></td>
      <td><code>string</code></td>
      <td>Screen route or path</td>
      <td>No</td>
    </tr>
    <tr>
      <td><code>sessionId</code></td>
      <td><code>string</code></td>
      <td>Session identifier</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td><code>deviceId</code></td>
      <td><code>string</code></td>
      <td>Device identifier</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td><code>type</code></td>
      <td><code>string</code></td>
      <td>Event type (e.g., "screen", "custom")</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td><code>appVersion</code></td>
      <td><code>string</code></td>
      <td>Application version</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td><code>clientCreationDate</code></td>
      <td><code>number</code></td>
      <td>Unix timestamp when event was created on client (milliseconds)</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td><code>serverReceivedDate</code></td>
      <td><code>number</code></td>
      <td>Unix timestamp when event was received by server (milliseconds)</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td><code>clientCreationHumanReadableDate</code></td>
      <td><code>string</code></td>
      <td>Human-readable client creation date</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td><code>serverReceivedHumanReadableDate</code></td>
      <td><code>string</code></td>
      <td>Human-readable server received date</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td><code>country</code></td>
      <td><code>string</code></td>
      <td>User's country</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td><code>city</code></td>
      <td><code>string</code></td>
      <td>User's city</td>
      <td>No</td>
    </tr>
    <tr>
      <td><code>deviceSystemName</code></td>
      <td><code>string</code></td>
      <td>Operating system (e.g., "iOS", "Android")</td>
      <td>No</td>
    </tr>
    <tr>
      <td><code>deviceSystemVersion</code></td>
      <td><code>string</code></td>
      <td>Operating system version</td>
      <td>No</td>
    </tr>
    <tr>
      <td><code>deviceModel</code></td>
      <td><code>string</code></td>
      <td>Device model</td>
      <td>No</td>
    </tr>
    <tr>
      <td><code>metadata</code></td>
      <td><code>object</code></td>
      <td>Custom event data and properties</td>
      <td>No</td>
    </tr>
  </tbody>
</table>

## Usage Examples

### Basic Event Export
```bash
# Export all events for an app
curl --location --request GET 'https://api.vexo.co/external/apps/your-app-id/events' \
--header 'Authorization: {AUTH_TOKEN}'
```

### Date Range Export
```bash
# Export events from the last 24 hours
curl --location --request GET 'https://api.vexo.co/external/apps/your-app-id/events?from=1640908800000&to=1640995200000' \
--header 'Authorization: {AUTH_TOKEN}'
```

### Paginated Export
```bash
# Export events with pagination
curl --location --request GET 'https://api.vexo.co/external/apps/your-app-id/events?itemsPerPage=500&page=2' \
--header 'Authorization: {AUTH_TOKEN}'
```

## Rate Limits

- Maximum 5 requests per application per minute
- Maximum 10,000 events per request (default is max)
- Authentication tokens work the same as normal login behavior

## Error Responses

<table>
  <thead>
    <tr>
      <th>Status Code</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>401</code></td>
      <td>Invalid or expired authentication token</td>
    </tr>
    <tr>
      <td><code>403</code></td>
      <td>Access denied to the specified application</td>
    </tr>
    <tr>
      <td><code>404</code></td>
      <td>Application not found</td>
    </tr>
    <tr>
      <td><code>429</code></td>
      <td>Rate limit exceeded</td>
    </tr>
    <tr>
      <td><code>500</code></td>
      <td>Internal server error</td>
    </tr>
  </tbody>
</table>

export default ({ children }) => <DocLayout current="export-api" next={{href: 'changelog', label: 'Changelog'}}>{children}</DocLayout>
